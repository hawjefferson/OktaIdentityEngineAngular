{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport AuthSdkError from '../errors/AuthSdkError.js';\nimport { EVENT_EXPIRED } from '../oidc/types/TokenManager.js';\nimport { isBrowser } from '../features.js';\n\nvar AutoRenewService = /*#__PURE__*/function () {\n  function AutoRenewService(tokenManager) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, AutoRenewService);\n\n    this.started = false;\n    this.tokenManager = tokenManager;\n    this.options = options;\n    this.renewTimeQueue = [];\n    this.onTokenExpiredHandler = this.onTokenExpiredHandler.bind(this);\n  }\n\n  _createClass(AutoRenewService, [{\n    key: \"shouldThrottleRenew\",\n    value: function shouldThrottleRenew() {\n      var res = false;\n      this.renewTimeQueue.push(Date.now());\n\n      if (this.renewTimeQueue.length >= 10) {\n        var firstTime = this.renewTimeQueue.shift();\n        var lastTime = this.renewTimeQueue[this.renewTimeQueue.length - 1];\n        res = lastTime - firstTime < 30 * 1000;\n      }\n\n      return res;\n    }\n  }, {\n    key: \"requiresLeadership\",\n    value: function requiresLeadership() {\n      return !!this.options.syncStorage && isBrowser();\n    }\n  }, {\n    key: \"onTokenExpiredHandler\",\n    value: function onTokenExpiredHandler(key) {\n      if (this.options.autoRenew) {\n        if (this.shouldThrottleRenew()) {\n          var error = new AuthSdkError('Too many token renew requests');\n          this.tokenManager.emitError(error);\n        } else {\n          this.tokenManager.renew(key).catch(function () {});\n        }\n      } else if (this.options.autoRemove) {\n        this.tokenManager.remove(key);\n      }\n    }\n  }, {\n    key: \"canStart\",\n    value: function canStart() {\n      return !!this.options.autoRenew || !!this.options.autoRemove;\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.canStart()) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 3;\n              return this.stop();\n\n            case 3:\n              this.tokenManager.on(EVENT_EXPIRED, this.onTokenExpiredHandler);\n              this.started = true;\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n\n      function start() {\n        return _start.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function () {\n      var _stop = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (this.started) {\n                this.tokenManager.off(EVENT_EXPIRED, this.onTokenExpiredHandler);\n                this.renewTimeQueue = [];\n                this.started = false;\n              }\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n\n      function stop() {\n        return _stop.apply(this, arguments);\n      }\n\n      return stop;\n    }()\n  }, {\n    key: \"isStarted\",\n    value: function isStarted() {\n      return this.started;\n    }\n  }]);\n\n  return AutoRenewService;\n}();\n\nexport { AutoRenewService }; //# sourceMappingURL=AutoRenewService.js.map","map":null,"metadata":{},"sourceType":"module"}