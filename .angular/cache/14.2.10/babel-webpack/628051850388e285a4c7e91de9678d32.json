{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/jeffersonhaw/Documents/CebPacAngular/samples-js-angular/okta-hosted-login/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport AuthApiError from '../../../errors/AuthApiError.js';\nimport { httpRequest } from '../../../http/request.js';\nimport 'tiny-emitter';\nimport 'js-cookie';\nimport 'cross-fetch';\nimport { divideActionParamsByMutability } from './actionParser.js';\n\nvar generateDirectFetch = function generateDirectFetch(authClient, _ref) {\n  var actionDefinition = _ref.actionDefinition,\n      _ref$defaultParamsFor = _ref.defaultParamsForAction,\n      defaultParamsForAction = _ref$defaultParamsFor === void 0 ? {} : _ref$defaultParamsFor,\n      _ref$immutableParamsF = _ref.immutableParamsForAction,\n      immutableParamsForAction = _ref$immutableParamsF === void 0 ? {} : _ref$immutableParamsF,\n      _ref$toPersist = _ref.toPersist,\n      toPersist = _ref$toPersist === void 0 ? {} : _ref$toPersist;\n  var target = actionDefinition.href;\n  return /*#__PURE__*/_asyncToGenerator(function () {\n    var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var _a, headers, body, response, _response, payload, wwwAuthHeader, idxResponse;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            headers = {\n              'Content-Type': 'application/json',\n              'Accept': actionDefinition.accepts || 'application/ion+json'\n            };\n            body = JSON.stringify(Object.assign(Object.assign(Object.assign({}, defaultParamsForAction), params), immutableParamsForAction));\n            _context.prev = 2;\n            _context.next = 5;\n            return httpRequest(authClient, {\n              url: target,\n              method: actionDefinition.method,\n              headers: headers,\n              args: body,\n              withCredentials: (_a = toPersist === null || toPersist === void 0 ? void 0 : toPersist.withCredentials) !== null && _a !== void 0 ? _a : true\n            });\n\n          case 5:\n            response = _context.sent;\n            return _context.abrupt(\"return\", authClient.idx.makeIdxResponse(Object.assign({}, response), toPersist, true));\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](2);\n\n            if (!(!(_context.t0 instanceof AuthApiError) || !(_context.t0 === null || _context.t0 === void 0 ? void 0 : _context.t0.xhr))) {\n              _context.next = 13;\n              break;\n            }\n\n            throw _context.t0;\n\n          case 13:\n            _response = _context.t0.xhr;\n            payload = _response.responseJSON || JSON.parse(_response.responseText);\n            wwwAuthHeader = _response.headers['WWW-Authenticate'] || _response.headers['www-authenticate'];\n            idxResponse = authClient.idx.makeIdxResponse(Object.assign({}, payload), toPersist, false);\n\n            if (_response.status === 401 && wwwAuthHeader === 'Oktadevicejwt realm=\"Okta Device\"') {\n              idxResponse.stepUp = true;\n            }\n\n            return _context.abrupt(\"return\", idxResponse);\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[2, 9]]);\n    })();\n  });\n};\n\nvar generateIdxAction = function generateIdxAction(authClient, actionDefinition, toPersist) {\n  var generator = generateDirectFetch;\n\n  var _divideActionParamsBy = divideActionParamsByMutability(actionDefinition),\n      defaultParams = _divideActionParamsBy.defaultParams,\n      neededParams = _divideActionParamsBy.neededParams,\n      immutableParams = _divideActionParamsBy.immutableParams;\n\n  var action = generator(authClient, {\n    actionDefinition: actionDefinition,\n    defaultParamsForAction: defaultParams[actionDefinition.name],\n    immutableParamsForAction: immutableParams[actionDefinition.name],\n    toPersist: toPersist\n  });\n  action.neededParams = neededParams;\n  return action;\n};\n\nexport { generateIdxAction as default }; //# sourceMappingURL=generateIdxAction.js.map","map":null,"metadata":{},"sourceType":"module"}